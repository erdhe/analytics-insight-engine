<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Insight Engine</title>
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.23.5/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/recharts@2.5.0/dist/Recharts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0e14;
            --bg-secondary: #151921;
            --bg-tertiary: #1f2430;
            --text-primary: #e6e8eb;
            --text-secondary: #9ca3af;
            --text-muted: #6b7280;
            --accent: #00d4aa;
            --accent-hover: #00ffcc;
            --border: #2d3340;
            --error: #ff6b6b;
            --warning: #ffd93d;
            --success: #00d4aa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 1.5rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header-content {
            max-width: 1800px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: 'Instrument Serif', serif;
            font-size: 1.5rem;
            font-weight: 600;
            letter-spacing: -0.02em;
            color: var(--accent);
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn {
            padding: 0.6rem 1.2rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            border-radius: 6px;
        }

        .btn:hover {
            background: var(--bg-primary);
            border-color: var(--accent);
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: var(--accent);
            color: var(--bg-primary);
            border-color: var(--accent);
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--accent-hover);
            border-color: var(--accent-hover);
        }

        /* Main Layout */
        .main-content {
            flex: 1;
            display: flex;
            max-width: 1800px;
            width: 100%;
            margin: 0 auto;
            gap: 2rem;
            padding: 2rem;
        }

        .sidebar {
            width: 320px;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .main-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            min-width: 0;
        }

        /* Card Component */
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            transition: border-color 0.2s ease;
        }

        .card:hover {
            border-color: var(--accent);
        }

        .card-title {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            font-weight: 500;
        }

        /* Upload Zone */
        .upload-zone {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg-tertiary);
        }

        .upload-zone:hover,
        .upload-zone.drag-over {
            border-color: var(--accent);
            background: rgba(0, 212, 170, 0.05);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .upload-text {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .upload-subtext {
            color: var(--text-muted);
            font-size: 0.8rem;
            margin-top: 0.5rem;
        }

        /* File List */
        .file-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.85rem;
        }

        .file-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .file-name {
            color: var(--text-primary);
            font-weight: 500;
        }

        .file-meta {
            color: var(--text-muted);
            font-size: 0.75rem;
        }

        .file-remove {
            background: none;
            border: none;
            color: var(--error);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0.25rem;
        }

        /* Insights Panel */
        .insights-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .insight-item {
            padding: 1rem;
            background: var(--bg-tertiary);
            border-left: 3px solid var(--accent);
            border-radius: 4px;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .insight-loading {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Chat Interface */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
            min-height: 500px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .message {
            display: flex;
            gap: 1rem;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--bg-primary);
            flex-shrink: 0;
        }

        .message-user .message-avatar {
            background: var(--bg-tertiary);
            color: var(--accent);
        }

        .message-content {
            flex: 1;
            max-width: 70%;
        }

        .message-user .message-content {
            text-align: right;
        }

        .message-bubble {
            background: var(--bg-tertiary);
            padding: 1rem 1.25rem;
            border-radius: 12px;
            font-size: 0.9rem;
            line-height: 1.6;
            display: inline-block;
            text-align: left;
        }

        .message-user .message-bubble {
            background: rgba(0, 212, 170, 0.1);
            border: 1px solid var(--accent);
        }

        .chat-input-container {
            padding: 1.5rem;
            background: var(--bg-tertiary);
            border-top: 1px solid var(--border);
        }

        .chat-input-wrapper {
            display: flex;
            gap: 1rem;
        }

        .chat-input {
            flex: 1;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 0.75rem 1rem;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            resize: none;
            min-height: 44px;
            max-height: 120px;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        /* Empty State */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-muted);
            text-align: center;
            padding: 3rem;
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .empty-title {
            font-family: 'Instrument Serif', serif;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        /* Status Badge */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            background: rgba(0, 212, 170, 0.1);
            border: 1px solid var(--accent);
            border-radius: 12px;
            font-size: 0.75rem;
            color: var(--accent);
        }

        .status-dot {
            width: 6px;
            height: 6px;
            background: var(--accent);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent);
        }

        /* API Key Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
        }

        .modal-title {
            font-family: 'Instrument Serif', serif;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--accent);
        }

        .modal-text {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            line-height: 1.8;
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-label {
            display: block;
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
        }

        .input-field {
            width: 100%;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 0.75rem 1rem;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--accent);
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .link {
            color: var(--accent);
            text-decoration: none;
        }

        .link:hover {
            text-decoration: underline;
        }

        .alert {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid var(--error);
            border-radius: 6px;
            padding: 1rem;
            color: var(--error);
            font-size: 0.85rem;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { LineChart, Line, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;

        function AnalyticsInsightEngine() {
            const [apiKey, setApiKey] = useState('');
            const [showApiKeyModal, setShowApiKeyModal] = useState(true);
            const [files, setFiles] = useState([]);
            const [parsedData, setParsedData] = useState([]);
            const [insights, setInsights] = useState([]);
            const [messages, setMessages] = useState([]);
            const [inputValue, setInputValue] = useState('');
            const [isAnalyzing, setIsAnalyzing] = useState(false);
            const [isSending, setIsSending] = useState(false);
            const [error, setError] = useState('');
            const chatEndRef = useRef(null);
            const fileInputRef = useRef(null);

            // Load API key from localStorage
            useEffect(() => {
                const savedKey = localStorage.getItem('anthropic-api-key');
                if (savedKey) {
                    setApiKey(savedKey);
                    setShowApiKeyModal(false);
                }
            }, []);

            // Auto-scroll chat
            useEffect(() => {
                chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            }, [messages]);

            const saveApiKey = () => {
                if (!apiKey.trim()) {
                    setError('Please enter an API key');
                    return;
                }
                if (!apiKey.startsWith('sk-ant-')) {
                    setError('API key should start with sk-ant-');
                    return;
                }
                localStorage.setItem('anthropic-api-key', apiKey.trim());
                setShowApiKeyModal(false);
                setError('');
            };

            const handleFileUpload = (e) => {
                const selectedFiles = Array.from(e.target.files || []);
                processFiles(selectedFiles);
            };

            const handleDrop = (e) => {
                e.preventDefault();
                const droppedFiles = Array.from(e.dataTransfer.files);
                processFiles(droppedFiles);
            };

            const processFiles = (newFiles) => {
                const updatedFiles = [...files, ...newFiles.map(f => ({
                    name: f.name,
                    size: (f.size / 1024).toFixed(1) + ' KB',
                    type: f.name.split('.').pop().toUpperCase(),
                    file: f
                }))];
                setFiles(updatedFiles);

                // Parse files
                newFiles.forEach(file => parseFile(file));
            };

            const parseFile = (file) => {
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    const content = e.target.result;
                    
                    if (file.name.endsWith('.csv')) {
                        Papa.parse(content, {
                            header: true,
                            dynamicTyping: true,
                            complete: (results) => {
                                addParsedData(file.name, results.data);
                            }
                        });
                    } else if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                        const workbook = XLSX.read(content, { type: 'binary' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const data = XLSX.utils.sheet_to_json(firstSheet);
                        addParsedData(file.name, data);
                    }
                };

                if (file.name.endsWith('.csv')) {
                    reader.readAsText(file);
                } else {
                    reader.readAsBinaryString(file);
                }
            };

            const addParsedData = (fileName, data) => {
                const cleanData = data.filter(row => Object.keys(row).length > 0);
                const newData = { 
                    fileName, 
                    data: cleanData, 
                    rows: cleanData.length, 
                    columns: Object.keys(cleanData[0] || {}) 
                };
                setParsedData(prev => [...prev, newData]);
                
                // Generate auto-insights
                generateAutoInsights(newData);
            };

            const generateAutoInsights = async (dataSet) => {
                setIsAnalyzing(true);
                
                const sampleData = dataSet.data.slice(0, 5);
                const columns = dataSet.columns.join(', ');
                
                const prompt = `Analyze this ${dataSet.fileName} dataset with ${dataSet.rows} rows and columns: ${columns}.

Sample data:
${JSON.stringify(sampleData, null, 2)}

Provide exactly 3-5 key insights in a numbered list. Focus on:
- Trends, patterns, or anomalies
- Top performers or outliers
- Actionable opportunities
- Cross-metric correlations

Be specific and data-driven. Each insight should be 1-2 sentences.`;

                try {
                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'x-api-key': apiKey,
                            'anthropic-version': '2023-06-01'
                        },
                        body: JSON.stringify({
                            model: 'claude-sonnet-4-20250514',
                            max_tokens: 1000,
                            messages: [{ role: 'user', content: prompt }]
                        })
                    });

                    const data = await response.json();
                    
                    if (data.error) {
                        throw new Error(data.error.message);
                    }
                    
                    const insightText = data.content[0].text;
                    
                    setInsights(prev => [...prev, {
                        fileName: dataSet.fileName,
                        insights: insightText,
                        timestamp: new Date().toISOString()
                    }]);
                } catch (error) {
                    console.error('Error generating insights:', error);
                    setInsights(prev => [...prev, {
                        fileName: dataSet.fileName,
                        insights: `Error: ${error.message}. Please check your API key in the header settings.`,
                        timestamp: new Date().toISOString()
                    }]);
                }
                
                setIsAnalyzing(false);
            };

            const removeFile = (index) => {
                const fileName = files[index].name;
                setFiles(prev => prev.filter((_, i) => i !== index));
                setParsedData(prev => prev.filter(d => d.fileName !== fileName));
                setInsights(prev => prev.filter(i => i.fileName !== fileName));
            };

            const handleSendMessage = async () => {
                if (!inputValue.trim() || isSending) return;
                if (parsedData.length === 0) {
                    alert('Please upload data files first');
                    return;
                }

                const userMessage = inputValue.trim();
                setInputValue('');
                setMessages(prev => [...prev, { role: 'user', content: userMessage }]);
                setIsSending(true);

                try {
                    // Prepare data context
                    const dataContext = parsedData.map(d => ({
                        file: d.fileName,
                        rows: d.rows,
                        columns: d.columns,
                        sample: d.data.slice(0, 3)
                    }));

                    const systemPrompt = `You are an expert data analyst helping analyze GA4 analytics, paid advertising, and martech stack data. 

Available datasets:
${JSON.stringify(dataContext, null, 2)}

When answering:
- Be specific and data-driven
- Reference actual numbers from the data when possible
- Focus on actionable insights
- Keep responses concise and professional
- If you need more data to answer accurately, ask for clarification

Answer questions based on the available data.`;

                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'x-api-key': apiKey,
                            'anthropic-version': '2023-06-01'
                        },
                        body: JSON.stringify({
                            model: 'claude-sonnet-4-20250514',
                            max_tokens: 2000,
                            system: systemPrompt,
                            messages: [
                                ...messages.map(m => ({ role: m.role, content: m.content })),
                                { role: 'user', content: userMessage }
                            ]
                        })
                    });

                    const data = await response.json();
                    
                    if (data.error) {
                        throw new Error(data.error.message);
                    }
                    
                    const assistantMessage = data.content[0].text;
                    
                    setMessages(prev => [...prev, { role: 'assistant', content: assistantMessage }]);
                } catch (error) {
                    console.error('Error sending message:', error);
                    setMessages(prev => [...prev, { 
                        role: 'assistant', 
                        content: `Error: ${error.message}. Please check your API key.` 
                    }]);
                }

                setIsSending(false);
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSendMessage();
                }
            };

            const exportReport = () => {
                const reportContent = `ANALYTICS INSIGHT REPORT
Generated: ${new Date().toLocaleString()}

=== DATASETS ===
${files.map(f => `- ${f.name} (${f.size})`).join('\n')}

=== AUTO-GENERATED INSIGHTS ===
${insights.map(i => `\n${i.fileName}:\n${i.insights}`).join('\n\n')}

=== CONVERSATION ANALYSIS ===
${messages.map(m => `\n[${m.role.toUpperCase()}]: ${m.content}`).join('\n')}
                `;

                const blob = new Blob([reportContent], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `analytics-report-${Date.now()}.txt`;
                a.click();
            };

            const clearSession = () => {
                if (confirm('Clear all data and start fresh?')) {
                    setFiles([]);
                    setParsedData([]);
                    setInsights([]);
                    setMessages([]);
                }
            };

            return (
                <div className="app-container">
                    {showApiKeyModal && (
                        <div className="modal-overlay">
                            <div className="modal">
                                <div className="modal-title">Welcome to Analytics Insight Engine</div>
                                <div className="modal-text">
                                    To use this app, you need an Anthropic API key. The AI will analyze your data locally in your browser.
                                </div>
                                <div className="modal-text">
                                    Get your API key at <a href="https://console.anthropic.com/" target="_blank" className="link">console.anthropic.com</a>
                                </div>
                                <div className="input-group">
                                    <label className="input-label">Anthropic API Key</label>
                                    <input
                                        type="password"
                                        className="input-field"
                                        placeholder="sk-ant-..."
                                        value={apiKey}
                                        onChange={(e) => setApiKey(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && saveApiKey()}
                                    />
                                </div>
                                {error && <div className="alert">{error}</div>}
                                <div className="modal-actions">
                                    <button className="btn btn-primary" onClick={saveApiKey}>
                                        Save & Continue
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    <header className="header">
                        <div className="header-content">
                            <div className="logo">Analytics Insight Engine</div>
                            <div className="header-actions">
                                {parsedData.length > 0 && (
                                    <div className="status-badge">
                                        <div className="status-dot"></div>
                                        {parsedData.length} dataset{parsedData.length !== 1 ? 's' : ''} loaded
                                    </div>
                                )}
                                <button className="btn" onClick={exportReport} disabled={messages.length === 0}>
                                    Export Report
                                </button>
                                <button className="btn" onClick={() => setShowApiKeyModal(true)}>
                                    API Settings
                                </button>
                                <button className="btn" onClick={clearSession}>
                                    Clear Session
                                </button>
                            </div>
                        </div>
                    </header>

                    <div className="main-content">
                        <aside className="sidebar">
                            <div className="card">
                                <div className="card-title">Upload Data</div>
                                <input
                                    type="file"
                                    ref={fileInputRef}
                                    onChange={handleFileUpload}
                                    accept=".csv,.xlsx,.xls"
                                    multiple
                                    style={{ display: 'none' }}
                                />
                                <div 
                                    className="upload-zone"
                                    onClick={() => fileInputRef.current?.click()}
                                    onDrop={handleDrop}
                                    onDragOver={(e) => e.preventDefault()}
                                >
                                    <div className="upload-icon">ðŸ“Š</div>
                                    <div className="upload-text">Drop files or click to upload</div>
                                    <div className="upload-subtext">CSV, XLSX â€¢ GA4, Ads, Martech</div>
                                </div>

                                {files.length > 0 && (
                                    <div className="file-list" style={{ marginTop: '1rem' }}>
                                        {files.map((file, index) => (
                                            <div key={index} className="file-item">
                                                <div className="file-info">
                                                    <div className="file-name">{file.name}</div>
                                                    <div className="file-meta">{file.type} â€¢ {file.size}</div>
                                                </div>
                                                <button className="file-remove" onClick={() => removeFile(index)}>Ã—</button>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>

                            {(insights.length > 0 || isAnalyzing) && (
                                <div className="card">
                                    <div className="card-title">Auto-Generated Insights</div>
                                    <div className="insights-container">
                                        {isAnalyzing && (
                                            <div className="insight-loading">
                                                <div className="spinner"></div>
                                                Analyzing data...
                                            </div>
                                        )}
                                        {insights.map((insight, index) => (
                                            <div key={index} className="insight-item">
                                                <div style={{ fontWeight: 600, marginBottom: '0.5rem', color: 'var(--accent)' }}>
                                                    {insight.fileName}
                                                </div>
                                                <div style={{ whiteSpace: 'pre-wrap' }}>{insight.insights}</div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </aside>

                        <main className="main-area">
                            <div className="chat-container">
                                <div className="chat-messages">
                                    {messages.length === 0 ? (
                                        <div className="empty-state">
                                            <div className="empty-icon">ðŸ’¬</div>
                                            <div className="empty-title">Ready to analyze your data</div>
                                            <div style={{ marginTop: '1rem', maxWidth: '400px' }}>
                                                Upload your GA4, paid ads, or martech data, then ask questions like:
                                                <ul style={{ textAlign: 'left', marginTop: '1rem', lineHeight: '2' }}>
                                                    <li>What are the top performing campaigns?</li>
                                                    <li>Show me conversion trends over time</li>
                                                    <li>Compare organic vs paid traffic</li>
                                                    <li>Which metrics need attention?</li>
                                                </ul>
                                            </div>
                                        </div>
                                    ) : (
                                        <>
                                            {messages.map((message, index) => (
                                                <div key={index} className={`message ${message.role === 'user' ? 'message-user' : ''}`}>
                                                    <div className="message-avatar">
                                                        {message.role === 'user' ? 'U' : 'AI'}
                                                    </div>
                                                    <div className="message-content">
                                                        <div className="message-bubble">
                                                            {message.content}
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                            {isSending && (
                                                <div className="message">
                                                    <div className="message-avatar">AI</div>
                                                    <div className="message-content">
                                                        <div className="message-bubble">
                                                            <div className="insight-loading">
                                                                <div className="spinner"></div>
                                                                Analyzing...
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            )}
                                            <div ref={chatEndRef} />
                                        </>
                                    )}
                                </div>

                                <div className="chat-input-container">
                                    <div className="chat-input-wrapper">
                                        <textarea
                                            className="chat-input"
                                            placeholder="Ask questions about your data..."
                                            value={inputValue}
                                            onChange={(e) => setInputValue(e.target.value)}
                                            onKeyPress={handleKeyPress}
                                            disabled={parsedData.length === 0}
                                        />
                                        <button 
                                            className="btn btn-primary" 
                                            onClick={handleSendMessage}
                                            disabled={!inputValue.trim() || isSending || parsedData.length === 0}
                                        >
                                            Send
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </main>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<AnalyticsInsightEngine />, document.getElementById('root'));
    </script>
</body>
</html>
